# 优化与新增功能建议

在现有「企业风控 + 尽调补充 + 风险量化 + 媒体爬虫」基础上，可从以下方向做优化或扩展，按**优先级**和**投入**大致分类。

---

## 一、体验与效率（优先考虑）

### 1. 企业列表搜索与筛选
- **现状**：顶部有全局搜索（企业名/资讯），企业列表本身无筛选项。
- **建议**：在企业管理/列表页增加：
  - 按**风险等级**（低/中/高）筛选；
  - 按**行业**筛选或下拉选择；
  - 按**关键词**（名称）搜索；
  - 可选：按「最近更新」「最近添加」排序。
- **价值**：企业多了之后快速定位，减少翻页。

### 2. 收藏/关注企业
- **现状**：库里有 `user_company_favorites` 与详情页「收藏」接口，列表或首页是否展示「我的收藏」需确认。
- **建议**：
  - 企业列表每行增加「星标」按钮，与收藏接口联动；
  - 首页或列表顶栏增加 Tab「全部 / 我的收藏」；
  - 收藏后可在首页「关注企业动态」区优先展示该企业最新资讯。
- **价值**：聚焦常看企业，信息更集中。

### 3. 仪表盘可视化增强
- **现状**：有企业数、今日资讯数、近期企业等。
- **建议**：
  - **趋势图**：近 7 天/30 天资讯数量趋势（接口已有 `/api/dashboard/trend`，前端可接图表）；
  - **风险分布**：饼图/柱状图 — 低/中/高风险企业数量；
  - **资讯分类分布**：法律/财务/经营/舆情占比；
  - **多维度风险分布**：按 legal/financial/operational/reputation 聚合展示。
- **价值**：一眼看到整体风险与舆情走势。

### 4. 报告导出增强
- **现状**：企业报告为 TXT 下载。
- **建议**：
  - 支持 **Excel**（.xlsx）：多 Sheet（基本信息、舆情、新闻、补充备注）；
  - 可选 **PDF**：排版更利于打印/归档；
  - 导出时包含「多维度风险」与「尽调补充摘要」。
- **价值**：满足内部分享、留痕、打印需求。

---

## 二、安全与健壮性

### 5. 配置与密钥安全
- **现状**：`SECRET_KEY` 等可能写死在代码中。
- **建议**：
  - 所有密钥、API Base URL、MediaCrawler 路径等从**环境变量**或 `.env` 读取，且 `.env` 不入库；
  - 在 README/部署文档中明确列出所需环境变量。
- **价值**：上线与多环境更安全。

### 6. init_db 与生产数据
- **现状**：`init_db()` 会 DROP 多张表再重建，适合开发，不适合生产。
- **建议**：
  - 生产环境**不要**在启动时自动执行带 DROP 的 init_db；或通过环境变量（如 `RUN_MIGRATIONS=1`）控制是否执行「仅新增列/表」的迁移逻辑；
  - 新表/新列统一用 `CREATE TABLE IF NOT EXISTS` / `ALTER TABLE ... ADD COLUMN`（已有部分），避免 DROP 已有数据。
- **价值**：避免误删生产数据。

### 7. 上传与输入校验
- **建议**：
  - 文件上传：限制类型（如仅 .txt/.pdf/.json）、大小上限、文件名 sanitize，防止路径穿越；
  - 尽调补充/API：对过长文本、特殊字符做长度与基本校验，防止滥用或注入。
- **价值**：安全与稳定性。

### 8. 操作审计（可选）
- **建议**：记录关键操作（如企业信息修改、导出报告、LLM 配置变更、平台登录上传）到 `audit_log` 表（user_id, action, target_type, target_id, created_at），便于追溯。
- **价值**：合规与问题排查。

---

## 三、功能扩展

### 9. 真正使用上传的 MediaCrawler 登录态
- **现状**：上传的 Cookie/Session 保存在 `data/mediacrawler_sessions/{platform}/`，爬虫逻辑是否使用未完全打通。
- **建议**：在 `mediacrawler_service.crawl_by_keyword` 执行前，若存在该平台 session 文件，则将其复制到 MediaCrawler 项目内其预期的 cookie/登录目录，或通过 MediaCrawler 支持的参数/环境变量指定登录态路径。
- **价值**：云上部署后无需每次本机扫码即可爬取。

### 10. 企业对比
- **建议**：新增「企业对比」入口（如勾选 2～4 家企业后点击「对比」），进入对比页并排展示：基本信息、风险等级、多维度风险、近期新闻条数、舆情摘要等。
- **价值**：尽调或立项时快速比较多家企业。

### 11. 风险变动提醒
- **建议**：
  - 定时或事件驱动：当某企业 `risk_level` 从低/中升为高，或新增「高风险」新闻时，写入提醒表或发送站内消息/邮件（若已配 SMTP）；
  - 设置页可配置「是否接收风险提醒」「提醒阈值（仅高/中高）」。
- **价值**：及时感知风险异动。

### 12. 企业级问答（RAG）
- **建议**：以企业为维度，将企业下的文档、链接摘要、尽调补充、新闻摘要等写入向量库（如用 OpenAI Embedding + 本地向量库或简单向量检索）；在企业详情页增加「问这家企业」输入框，用 RAG 回答与该公司相关的问题。
- **价值**：把零散信息变成可问答的知识库。

### 13. 定时爬取与任务可见性
- **现状**：有 scheduler 与用户「搜索间隔」等配置。
- **建议**：
  - 确保定时任务只做「拉取/刷新」不执行 DROP 等危险操作；
  - 设置页或单独「任务状态」页展示最近几次爬取/新闻搜索的成功与失败、耗时，便于排查。
- **价值**：运维可见、可控。

---

## 四、开发与运维体验

### 14. API 文档
- **建议**：用 Flask 集成 **Swagger/OpenAPI**（如 flasgger 或 apispec），或手写一份 `openapi.yaml`，列出主要接口的请求/响应示例。
- **价值**：前端/第三方对接与联调更顺畅。

### 15. 健康检查
- **建议**：提供 `GET /api/health`（或 `/health`）：仅做 DB 连接检查 + 可选 LLM/爬虫可达性，返回 200/503，便于负载均衡或 K8s 探针。
- **价值**：部署与监控更规范。

### 16. 结构化日志
- **建议**：关键路径（登录、爬取、LLM 调用、上传）打结构化日志（JSON 或统一格式），包含 request_id、user_id、耗时、错误码，便于集中收集与排查。
- **价值**：问题定位更快。

---

## 五、优先级小结

| 优先级 | 方向           | 示例项                          |
|--------|----------------|---------------------------------|
| 高     | 体验与效率     | 列表筛选/搜索、收藏、仪表盘图表、导出 Excel |
| 高     | 安全与数据     | 配置入 env、init_db 不 Drop 生产表、上传校验 |
| 中     | 功能扩展       | MediaCrawler 使用上传登录态、企业对比、风险提醒 |
| 中     | 进阶能力       | 企业级 RAG 问答、任务状态页     |
| 低     | 工程化         | API 文档、健康检查、审计日志、结构化日志 |

可按「当前最影响使用」和「实现成本」自行排期；若需要，我可以针对某一项写出更细的实现步骤（含接口与前端改动点）。
