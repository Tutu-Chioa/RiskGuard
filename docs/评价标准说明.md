# RiskGuard 评价标准说明

本文档说明项目中各类「评价标准」是如何制定的：风险等级、资讯分类、风险维度、情感分数、以及仪表盘上的风险指标与分布。

---

## 一、风险等级（低 / 中 / 高）

### 1. 单条新闻、单条舆情、文档/链接

- **制定方式**：由 **大模型（LLM）** 根据提示词判断，**没有写死在代码里的公式**。
- **取值**：仅允许 `低`、`中`、`高` 三者之一。
- **出处**：`backend/services/llm_service.py` 中的各类 Prompt（如 `PROMPT_NEWS_ANALYZE`、`PROMPT_NEWS_SEARCH`、`PROMPT_SENTIMENT`、`PROMPT_DOC_LINK_ANALYZE`）要求模型按「统一标准」输出 `risk_level`，具体高/中/低的判定依赖模型理解，代码只做格式校验与默认值（如解析失败时用 `中`）。

### 2. 企业整体风险等级（companies 表里的 risk_level）

- **制定方式**：来自 **媒体舆情/社会评价** 的一次性分析结果，不是对多条新闻的加权汇总。
- **流程**：
  - 添加企业或定时刷新时，会拉取该企业的媒体舆情文本；
  - 调用 `analyze_sentiment_and_keywords(企业名, 舆情文本)`，由 LLM 返回 `risk_level` 和 `summary`；
  - 该 `risk_level` **直接写入**企业表的 `risk_level` 字段（会覆盖之前的值）。
- **说明**：企业维度没有「根据多条新闻风险等级聚合出企业等级」的公式，当前就是「舆情分析一次 → 一个等级」。

---

## 二、资讯分类（category）

- **制定方式**：**固定枚举**，由 LLM 在分析每条新闻/文档时从枚举中选一。
- **取值**：`法律`、`财务`、`经营`、`舆情`、`其他`。
- **出处**：`llm_service.py` 中 `PROMPT_NEWS_ANALYZE`、`PROMPT_NEWS_SEARCH` 等写明：  
  `"category": "法律/财务/经营/舆情/其他"`。  
  前端展示（如仪表盘「资讯分类分布」）与后端统计都按这五类；未命中时归为「其他」。

---

## 三、风险维度（risk_dimensions）

- **制定方式**：由 **LLM** 按提示词输出，代码只校验取值是否为 低/中/高，不参与计算。
- **维度与取值**：
  - `legal_risk`：法律风险  
  - `financial_risk`：财务风险  
  - `operational_risk`：经营风险  
  - `reputation_risk`：舆情/声誉风险  
  每维仅允许 `低`、`中`、`高`。
- **出处**：同上，各分析类 Prompt 中规定结构；`_ensure_risk_dimensions()` 在解析后把非法值或缺失维统一成 `中`。

---

## 四、情感分数（sentiment_score）

- **制定方式**：由 **LLM** 直接给出，**没有代码侧公式**。
- **取值范围**：-1（极负面）到 1（极正面），0 为中性。
- **出处**：`PROMPT_SENTIMENT`、`PROMPT_NEWS_ANALYZE` 等要求模型输出该字段；入库与展示均直接使用该值。

---

## 五、仪表盘「风险指标」（/api/risk-indicators）

- **制定方式**：**代码中写死的规则**，对近 30 天企业相关资讯按「分类 + 风险等级」聚合后计算。
- **数据来源**：`company_news` 表，按 `category`、`risk_level` 分组统计条数。
- **每个分类的「指标等级」规则**（见 `app.py` 中 `get_risk_indicators`）：
  - 在该分类下，若 **高风险条数占比 < 20%** → 该指标等级为 **低**；
  - 若 **高风险条数占比 > 50%** → 该指标等级为 **高**；
  - 否则为 **中**。
- **change 字段**：该分类下所有资讯的 `sentiment_score` 的**平均值 × 100%**（如 0.3 → "+30%"）。

---

## 六、仪表盘「企业风险分布」（/api/dashboard/risk-distribution）

- **制定方式**：**直接统计**，无公式。
- **数据来源**：当前用户可见企业的 `companies.risk_level` 字段。
- **逻辑**：按 `risk_level`（高/中/低/未知）分组计数，返回各等级家数，用于饼图等展示。

---

## 七、小结表

| 评价项           | 制定方式         | 说明 |
|------------------|------------------|------|
| 单条 risk_level  | LLM 按提示词输出 | 无代码公式 |
| 企业 risk_level  | LLM 舆情分析结果 | 一次分析直接写入，非多新闻聚合 |
| 资讯 category    | 固定枚举 + LLM 选 | 法律/财务/经营/舆情/其他 |
| risk_dimensions  | LLM 按提示词输出 | 四维各 低/中/高 |
| sentiment_score  | LLM 直接输出     | -1～1 |
| 风险指标等级     | 代码规则         | 按分类：高占比 <20%→低，>50%→高，否则中 |
| 企业风险分布     | 直接统计         | 按 companies.risk_level 计数 |

若要调整「评价标准」，可考虑：  
- 改 **LLM 提示词**（`llm_service.py`）以改变单条风险/分类/维度/情感的判定口径；  
- 改 **风险指标**的阈值（`app.py` 中 20%、50%）以改变仪表盘指标等级；  
- 若希望企业等级由多条新闻聚合得出，需在现有逻辑上新增聚合规则（当前未实现）。
