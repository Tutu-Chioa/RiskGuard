openapi: 3.0.2
info:
  title: RiskGuard 企业风控 API
  description: 企业风险监控、尽调补充、报告导出等接口
  version: 1.0.0
servers:
  - url: /
    description: 当前服务
paths:
  /api/auth/login:
    post:
      summary: 登录
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                username: { type: string }
                password: { type: string }
      responses:
        '200': { description: 成功，返回 token 与 user }
  /api/companies:
    get:
      summary: 获取企业列表
      security: [{ bearerAuth: [] }]
      parameters:
        - name: search
          in: query
          schema: { type: string }
        - name: risk_level
          in: query
          schema: { type: string, enum: [低, 中, 高, 未知] }
        - name: sort
          in: query
          schema: { type: string }
      responses:
        '200': { description: 企业数组 }
  /api/companies/{company_id}:
    get:
      summary: 获取企业详情
      security: [{ bearerAuth: [] }]
      parameters:
        - name: company_id
          in: path
          required: true
          schema: { type: integer }
      responses:
        '200': { description: 企业详情 }
  /api/companies/{company_id}/export:
    get:
      summary: 导出报告 TXT
      security: [{ bearerAuth: [] }]
  /api/companies/{company_id}/export-excel:
    get:
      summary: 导出报告 Excel
      security: [{ bearerAuth: [] }]
  /api/companies/{company_id}/export-pdf:
    get:
      summary: 导出报告 PDF
      security: [{ bearerAuth: [] }]
  /api/companies/{company_id}/supplement-chat:
    post:
      summary: 尽调补充对话
      security: [{ bearerAuth: [] }]
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                text: { type: string }
      responses:
        '200': { description: 已归集，返回 summary、updates }
  /api/companies/{company_id}/ask:
    post:
      summary: 问这家企业（RAG 式问答）
      security: [{ bearerAuth: [] }]
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                question: { type: string }
      responses:
        '200': { description: 返回 { answer } }
  /api/alerts:
    get:
      summary: 风险警报列表
      security: [{ bearerAuth: [] }]
      parameters:
        - name: severity
          in: query
          schema: { type: string }
      responses:
        '200': { description: 警报数组 }
  /api/notifications:
    get:
      summary: 站内通知
      security: [{ bearerAuth: [] }]
      responses:
        '200': { description: { items, unread_count } }
  /api/audit-log:
    get:
      summary: 操作审计日志
      security: [{ bearerAuth: [] }]
  /api/alert-rules:
    get:
      summary: 预警规则列表
      security: [{ bearerAuth: [] }]
    post:
      summary: 新建预警规则
      security: [{ bearerAuth: [] }]
  /api/task-status/detailed:
    get:
      summary: 任务执行记录（细化）
      security: [{ bearerAuth: [] }]
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
